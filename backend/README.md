# Rest api

The project is generated by [LoopBack](http://loopback.io).

## Run the server

```bash
node .
```

## Datasource

To make the app easy to setup it uses an in-memory database by default. Which means every changes are lost when the server is shutdown.

If you want to persist your data you can edit [server/datasources.json](server/datasources.json).

###Configuration example:

```json
{
  "db": {
    "host": "<Your database host ex: localhost>",
    "port": "The port your database is listening on",
    "database": "<Database name>",
    "password": "********",
    "user": "<Database user with enough credentials>",
    "name": "db",
    "connector": "postgresql|mongodb|mysql|..."
  }
}
```
You then need to run
```bash
npm install --save <connector-module>
```
List of available connectors [here](https://loopback.io/doc/en/lb3/Database-connectors.html)

For more informations about datasources, head [here](https://loopback.io/doc/en/lb3/Defining-data-sources.html)

## Why loopback?

Loopback makes building rest-apis straightforward.
You define the models, their relationships, eventually throw some seeds and add some ACLs.
You get a running rest api following the openApi specifications (v2 for loopback 3).
The version 3 is built on top of Express therefore easy to extends (custom routes for instance).

## Models

We have 4 models:
* [Shopper](common/models/shopper.json) which extends the built-in User model (see [this](https://github.com/bigari/shops-nearby/commit/6c6041e428d47ab93f63bbaa5986f83f32ddc6d6)).
* [Shop](common/models/shop.json)
* [Category](common/models/category.json)
* [Reaction](common/models/reaction.json) to keep track of likes and dislikes.

And 5 Relations:

* Shop hasOne category
* Shopper hasMany Reaction
* Reaction belongs to Shopper
* Reaction belongs to Shop
* Shop hasMany reactions (Not useful)

## How we manage likes and dislikes

We only save the date at which the reaction has been made. (likedAt and dislikedAt)
Given a shop and a user we should have 0 or 1 reaction.
If the reaction does not exist then the shop has never been liked or disliked.
If the reaction exists then the presence of likedAt indicates the shop has been liked and should appear only in user preferences.
The presence of dislikedAt indicates the shop has been disliked and should not appear while currentDate - dislikedAt <= 2h.

There is no functionnal need to make likedAt a date. But because dislikedAt has to be a date and we need to keep types consistent, it is so. Plus it embeds more information so we only increase our options.